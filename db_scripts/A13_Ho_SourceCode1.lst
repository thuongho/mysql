--------------
-- Thuong Ho
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
    /* enable warnings! */

use a_testbed
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
/*  TASK 00 */ 
select user(), current_date(), version(), @@sql_mode
--------------

*************************** 1. row ***************************
        user(): root@localhost
current_date(): 2013-11-28
     version(): 5.6.13
    @@sql_mode: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
1 row in set (0.00 sec)

--------------
/*  Functions  */
delimiter #

/*  NameFormat  */
Drop function if exists a_testbed.NameFormat#
 
create FUNCTION a_testbed.NameFormat (
	p_mode char(1)
	, lastname varchar(25)
	, firstname varchar(25)
) 
    RETURNS varchar(52)
BEGIN
    declare v_message varchar(52)
--------------

--------------
    if (firstname is null) then
      set v_message = lastname
--------------

--------------
    elseif (p_mode = "F") then
      set v_message = concat(firstname, ' ', lastname)
--------------

--------------
    else
      set v_message = concat(lastname, ', ', firstname)
--------------

--------------
    end if
--------------

--------------
    return v_message
--------------

--------------
END
--------------

--------------
#
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
/*  InternalBlankCount  */
Drop function if exists a_testbed.InternalBlankCount#
 
create FUNCTION a_testbed.InternalBlankCount(
    in_string varchar(250)	
)
    RETURNS varchar(250)
BEGIN
    declare v_count varchar(250)
--------------

--------------
    declare v_trim varchar(250)
--------------

--------------
    declare v_srem varchar(250)
--------------

--------------
    
    if (coalesce(length(in_string), 0) > 0) then
      set v_trim = rtrim(ltrim(in_string))
--------------

--------------
      set v_srem = replace(v_trim, ' ', '')
--------------

Error (Code 1193): Unknown system variable 'v_srem'
Error (Code 1193): Unknown system variable 'v_srem'
--------------
      set v_count = length(v_trim) - length(v_srem)
--------------

Error (Code 1193): Unknown system variable 'v_count'
Error (Code 1193): Unknown system variable 'v_count'
--------------
    else
      set v_count = 0
--------------

--------------
    end if
--------------

--------------
    return v_count
--------------

--------------
END
--------------

--------------
#
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
/*  BookSize  */
Drop function if exists a_testbed.BookSize#
 
create FUNCTION a_testbed.BookSize(
    in_pages int	
)
    RETURNS varchar(25)
BEGIN
    declare v_message varchar(25)
--------------

--------------
    
    if (in_pages <= 200) then
      set v_message = "Mini"
--------------

--------------
	elseif (in_pages between 201 and 500) then
      set v_message = "Small"
--------------

--------------
	elseif (in_pages between 501 and 1000) then
      set v_message = "Medium"
--------------

--------------
    elseif (in_pages between 1001 and 1500) then
      set v_message = "Large"
--------------

--------------
    elseif (in_pages > 1500) then
      set v_message = "TooLong"
--------------

--------------
    else
      set v_message = "Invalid Input"
--------------

--------------
    end if
--------------

--------------
    return v_message
--------------

--------------
END
--------------

--------------
#
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
/*  PrevMonth v2 */
Drop function if exists a_testbed.PrevMonth#
 
create FUNCTION a_testbed.PrevMonth(
    in_date date
    ,in_mn_count int	
)
    RETURNS varchar(25)
BEGIN
    declare v_date varchar(25)
--------------

--------------
    set in_mn_count = coalesce(in_mn_count,0)
--------------

Error (Code 1193): Unknown system variable 'in_mn_count'
Error (Code 1193): Unknown system variable 'in_mn_count'
--------------
     
    if (in_date is null) then
      set in_date = current_date
--------------

--------------
    else
      set in_date = in_date
--------------

--------------
    end if
--------------

--------------
    set v_date = Date_format(Date_sub(in_date, interval in_mn_count month), '%Y-%m')
--------------

Error (Code 1193): Unknown system variable 'v_date'
Error (Code 1193): Unknown system variable 'v_date'
--------------
    return v_date
--------------

--------------
END
--------------

--------------
#
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
show create function BookSize
--------------

*************************** 1. row ***************************
            Function: BookSize
            sql_mode: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
     Create Function: CREATE DEFINER=`t_ho`@`localhost` FUNCTION `BookSize`(
    in_pages int
) RETURNS varchar(25) CHARSET latin1
BEGIN
    declare v_message varchar(25);
    
    if (in_pages <= 200) then
      set v_message = "Mini";
elseif (in_pages between 201 and 500) then
      set v_message = "Small";
elseif (in_pages between 501 and 1000) then
      set v_message = "Medium";
    elseif (in_pages between 1001 and 1500) then
      set v_message = "Large";
    elseif (in_pages > 1500) then
      set v_message = "TooLong";
    else
      set v_message = "Invalid Input";
    end if;

    return v_message;
END
character_set_client: utf8
collation_connection: utf8_general_ci
  Database Collation: latin1_swedish_ci
1 row in set (0.00 sec)

--------------
show create function InternalBlankCount
--------------

*************************** 1. row ***************************
            Function: InternalBlankCount
            sql_mode: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
     Create Function: CREATE DEFINER=`t_ho`@`localhost` FUNCTION `InternalBlankCount`(
    in_string varchar(250)
) RETURNS varchar(250) CHARSET latin1
BEGIN
    declare v_count varchar(250);
    declare v_trim varchar(250);
    declare v_srem varchar(250);
    
    if (coalesce(length(in_string), 0) > 0) then
      set v_trim = rtrim(ltrim(in_string));
      set v_srem = replace(v_trim, ' ', '');
      set v_count = length(v_trim) - length(v_srem);
    else
      set v_count = 0;
    end if;

    return v_count;    
END
character_set_client: utf8
collation_connection: utf8_general_ci
  Database Collation: latin1_swedish_ci
1 row in set (0.00 sec)

--------------
show create function NameFormat
--------------

*************************** 1. row ***************************
            Function: NameFormat
            sql_mode: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
     Create Function: CREATE DEFINER=`t_ho`@`localhost` FUNCTION `NameFormat`(
p_mode char(1)
, lastname varchar(25)
, firstname varchar(25)
) RETURNS varchar(52) CHARSET latin1
BEGIN
    declare v_message varchar(52);

    if (firstname is null) then
      set v_message = lastname;
    elseif (p_mode = "F") then
      set v_message = concat(firstname, ' ', lastname);
    else
      set v_message = concat(lastname, ', ', firstname);
    end if;

    return v_message;
END
character_set_client: utf8
collation_connection: utf8_general_ci
  Database Collation: latin1_swedish_ci
1 row in set (0.00 sec)

--------------
show create function PrevMonth
--------------

*************************** 1. row ***************************
            Function: PrevMonth
            sql_mode: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
     Create Function: CREATE DEFINER=`t_ho`@`localhost` FUNCTION `PrevMonth`(
    in_date date
    ,in_mn_count int
) RETURNS varchar(25) CHARSET latin1
BEGIN
    declare v_date varchar(25);
    set in_mn_count = coalesce(in_mn_count,0);
     
    if (in_date is null) then
      set in_date = current_date;
    else
      set in_date = in_date;
    end if; 

    set v_date = Date_format(Date_sub(in_date, interval in_mn_count month), '%Y-%m');   

    return v_date;
END
character_set_client: utf8
collation_connection: utf8_general_ci
  Database Collation: latin1_swedish_ci
1 row in set (0.00 sec)

Bye
