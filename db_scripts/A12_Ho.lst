--------------
-- Thuong Ho
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
    /* enable warnings! */

use a_testbed
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
/*  TASK 00 */ 
select user(), current_date(), version(), @@sql_mode
--------------

*************************** 1. row ***************************
        user(): t_ho@localhost
current_date(): 2013-11-16
     version(): 5.6.13
    @@sql_mode: STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION
1 row in set (0.00 sec)

--------------
/*  TASK 01 */
select * from upd_animals
--------------

+-------+-------------+---------+-----------+
| an_id | an_name     | an_type | an_status |
+-------+-------------+---------+-----------+
|   100 | Gutsy       | cat     | C         |
|   101 | Kenny       | SNAKE   | C         |
|   102 | Showboat    | bird    | C         |
|   103 | Mr Peanut   | bird    | NC        |
|   104 | Cartman     | Cat     | C         |
|   105 | Tweets      | bird    | C         |
|   106 | big mike    | Turtle  | C         |
|   107 | George      | CAT     | C         |
|   108 | Samuel      | Mollusk | NC        |
|   109 | Mr C        | Bird    | C         |
|   110 | Mr C        | dog     | C         |
|   111 | Mr Peabody  | Cat     | C         |
|   112 | Mr Smithers | Cat     | C         |
|   113 | Mr Whipple  | Cat     | NC        |
|   114 | Mittens     | Cat     | NC        |
+-------+-------------+---------+-----------+
15 rows in set (0.00 sec)

--------------
select * from upd_services
--------------

+--------+------------------------------+----------------+
| srv_id | srv_desc                     | srv_list_price |
+--------+------------------------------+----------------+
|    100 | Consult- no charge           |           0.00 |
|    101 | Routine Exam- Bird           |          35.00 |
|    102 | Followup Exam-Bird           |          32.00 |
|    103 | Routine Exam-Feline          |          50.00 |
|    104 | Followup Exam-Feline         |          45.00 |
|    105 | Routine Exam-Reptile         |          25.00 |
|    106 | Followup Exam-Reptile        |          23.00 |
|    107 | Rabies_V-2008 SFall-Canine   |          15.00 |
|    108 | Rabies_V-2008 SFall-Feline   |          15.00 |
|    109 | Rabies_Ve-2008 Spring-Canine |          25.00 |
|    110 | Rabies_V-2008 Spring-Feline  |          25.00 |
|    111 | Rabies_V-Rodent              |          20.00 |
|    112 | Rabies_V-2008 Winter-Canine  |          15.00 |
|    118 | First Feline PCR             |          20.25 |
|    119 | Second Feline PCR            |          20.25 |
|    120 | Third Feline PCR             |          20.25 |
|    121 | Flu Rhino Vacc               |          26.00 |
|    122 | Scaly Mite                   |          35.00 |
|    123 | Intestinal Parasite Screen   |          26.00 |
|    124 | Tick Removal                 |          15.00 |
|    125 | Behaviour Modification       |          75.00 |
|    126 | Vitamin E- Concentrated      |          30.00 |
|    127 | Sedative-Feline              |          25.00 |
|    128 | Flea Treatment- Small Animal |          35.00 |
|    129 | Flea Treatment- Large Animal |          50.00 |
|    143 | Rabies_V-2010 SFall-Canine   |          15.00 |
|    144 | Rabies_V-2010 SFall-Feline   |          15.00 |
|    145 | Rabies_V-2010 Spring-Canine  |          25.00 |
|    146 | Rabies_V-2010 Spring-Feline  |          25.00 |
|    147 | Rabies_V-2010 Winter-Canine  |          15.00 |
+--------+------------------------------+----------------+
30 rows in set (0.00 sec)

--------------
select * from upd_exam_headers
--------------

+-------+------------+-------+
| ex_id | ex_date    | an_id |
+-------+------------+-------+
|  1001 | 2012-01-18 |   104 |
|  1002 | 2013-01-18 |   101 |
|  1003 | 2011-09-18 |   103 |
|  1004 | 2011-10-22 |   110 |
|  1005 | 2013-02-28 |   104 |
|  1006 | 2011-03-18 |   106 |
|  1007 | 2010-01-18 |   111 |
|  1008 | 2009-02-02 |   111 |
|  1009 | 2011-03-02 |   103 |
|  1010 | 2009-01-30 |   109 |
|  1011 | 2011-12-15 |   108 |
|  1012 | 2012-10-02 |   107 |
|  1013 | 2013-02-22 |   110 |
|  1014 | 2012-03-25 |   109 |
|  1015 | 1995-03-25 |   114 |
|  1016 | 2012-10-15 |   113 |
|  1017 | 2012-10-25 |   113 |
+-------+------------+-------+
17 rows in set (0.00 sec)

--------------
select * from upd_exam_details
--------------

+-------+--------+---------+
| ex_id | srv_id | ex_fee  |
+-------+--------+---------+
|  1001 |    104 |  45.000 |
|  1001 |    123 |  26.000 |
|  1002 |    106 |  25.000 |
|  1002 |    123 |  26.000 |
|  1003 |    101 |  35.000 |
|  1003 |    122 |  35.000 |
|  1003 |    124 |  10.000 |
|  1005 |    104 |  50.000 |
|  1005 |    125 |  75.000 |
|  1006 |    105 |  25.000 |
|  1006 |    122 |  35.000 |
|  1006 |    123 |  26.000 |
|  1006 |    124 |  15.000 |
|  1007 |    104 |  45.000 |
|  1007 |    123 |  26.000 |
|  1008 |    110 |  26.000 |
|  1009 |    102 |  32.000 |
|  1009 |    121 |  26.000 |
|  1010 |    104 |  40.000 |
|  1010 |    108 |  15.000 |
|  1010 |    126 |  30.000 |
|  1011 |    105 |  45.000 |
|  1012 |    104 |  35.000 |
|  1012 |    123 |   0.000 |
|  1013 |    104 |  60.000 |
|  1013 |    143 |  15.000 |
|  1014 |    104 |  40.000 |
|  1015 |    104 | 140.250 |
|  1016 |    951 |  40.000 |
|  1017 |    235 |  40.000 |
+-------+--------+---------+
30 rows in set (0.00 sec)

--------------
/*  TASK 02 */
set @noncurrent = date_sub(current_date(), interval 18 month)
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
	
update upd_animals
Left Join upd_exam_headers using (an_id)
set an_status = 'NC'
Where an_id not in (
	Select an_id
	From upd_exam_headers 
	Where ex_date >= @noncurrent)
--------------

Query OK, 7 rows affected (0.05 sec)
Rows matched: 10  Changed: 7  Warnings: 0

--------------
Select *
From upd_animals
--------------

+-------+-------------+---------+-----------+
| an_id | an_name     | an_type | an_status |
+-------+-------------+---------+-----------+
|   100 | Gutsy       | cat     | NC        |
|   101 | Kenny       | SNAKE   | C         |
|   102 | Showboat    | bird    | NC        |
|   103 | Mr Peanut   | bird    | NC        |
|   104 | Cartman     | Cat     | C         |
|   105 | Tweets      | bird    | NC        |
|   106 | big mike    | Turtle  | NC        |
|   107 | George      | CAT     | C         |
|   108 | Samuel      | Mollusk | NC        |
|   109 | Mr C        | Bird    | NC        |
|   110 | Mr C        | dog     | C         |
|   111 | Mr Peabody  | Cat     | NC        |
|   112 | Mr Smithers | Cat     | NC        |
|   113 | Mr Whipple  | Cat     | NC        |
|   114 | Mittens     | Cat     | NC        |
+-------+-------------+---------+-----------+
15 rows in set (0.00 sec)

--------------
/*  TASK 03 */
Drop table if exists upd_nc_felines
--------------

Query OK, 0 rows affected (0.04 sec)

--------------
Create table upd_nc_felines as
Select an_id, an_name, max(ex_date) as 'rec_ex_date'
, round(sum(ex_fee), 2) as 'total_ex_fees'
From upd_animals 
Left Join upd_exam_headers using (an_id)
Left Join upd_exam_details using (ex_id)
Where an_status = 'NC'
And an_type = 'cat'
group by an_id
--------------

Query OK, 5 rows affected (0.30 sec)
Records: 5  Duplicates: 0  Warnings: 0

--------------
Select * from upd_nc_felines
--------------

+-------+-------------+-------------+---------------+
| an_id | an_name     | rec_ex_date | total_ex_fees |
+-------+-------------+-------------+---------------+
|   100 | Gutsy       | NULL        |          NULL |
|   111 | Mr Peabody  | 2010-01-18  |         97.00 |
|   112 | Mr Smithers | NULL        |          NULL |
|   113 | Mr Whipple  | 2012-10-25  |         80.00 |
|   114 | Mittens     | 1995-03-25  |        140.25 |
+-------+-------------+-------------+---------------+
5 rows in set (0.00 sec)

--------------
-- this includes Mr. Whipples who should be in C but was set to NC as default
--------------

Query OK, 0 rows affected (0.00 sec)

--------------
/*  TASK 04 */
Select an_id, an_name, ex_date
From upd_animals
Join upd_exam_headers using (an_id)
Where an_status = 'C'
--------------

+-------+---------+------------+
| an_id | an_name | ex_date    |
+-------+---------+------------+
|   104 | Cartman | 2012-01-18 |
|   101 | Kenny   | 2013-01-18 |
|   110 | Mr C    | 2011-10-22 |
|   104 | Cartman | 2013-02-28 |
|   107 | George  | 2012-10-02 |
|   110 | Mr C    | 2013-02-22 |
+-------+---------+------------+
6 rows in set (0.01 sec)

--------------
/*  TASK 05 */
Select an_id, an_name, max(ex_date)
From upd_animals
Join upd_exam_headers using (an_id)
Where an_status = 'C'
group by an_id
--------------

+-------+---------+--------------+
| an_id | an_name | max(ex_date) |
+-------+---------+--------------+
|   101 | Kenny   | 2013-01-18   |
|   104 | Cartman | 2013-02-28   |
|   107 | George  | 2012-10-02   |
|   110 | Mr C    | 2013-02-22   |
+-------+---------+--------------+
4 rows in set (0.00 sec)

--------------
/*  TASK 06 */
replace into upd_services
Select * 
From upd_services_changes_1
--------------

Query OK, 7 rows affected (0.00 sec)
Records: 7  Duplicates: 0  Warnings: 0

--------------
Select *
From upd_services
Order by srv_id
--------------

+--------+------------------------------+----------------+
| srv_id | srv_desc                     | srv_list_price |
+--------+------------------------------+----------------+
|    100 | Consult- no charge           |           0.00 |
|    101 | Routine Exam- Bird           |          35.00 |
|    102 | Followup Exam-Bird           |          32.00 |
|    103 | Routine Exam-Feline          |          50.00 |
|    104 | Followup Exam-Feline         |          45.00 |
|    105 | Routine Exam-Reptile         |          25.00 |
|    106 | Followup Exam-Reptile        |          23.00 |
|    107 | Rabies_V-2008 SFall-Canine   |          15.00 |
|    108 | Rabies_V-2008 SFall-Feline   |          15.00 |
|    109 | Rabies_Ve-2008 Spring-Canine |          25.00 |
|    110 | Rabies_V-2008 Spring-Feline  |          25.00 |
|    111 | Rabies_V-Rodent              |          20.00 |
|    112 | Rabies_V-2008 Winter-Canine  |          15.00 |
|    113 | Amphib skin Ointment         |          75.00 |
|    116 | Reptile dental procedure     |         175.00 |
|    117 | Amphib dental procedure      |         375.00 |
|    118 | First Feline PCR             |          20.25 |
|    119 | Second Feline PCR            |          20.25 |
|    120 | Third Feline PCR             |          20.25 |
|    121 | Flu Rhino Vacc               |          26.00 |
|    122 | Scaly Mite                   |          35.00 |
|    123 | Intestinal Parasite Screen   |          26.00 |
|    124 | Tick Removal                 |          15.00 |
|    125 | Behaviour Modification       |          75.00 |
|    126 | Vitamin E- Concentrated      |          30.00 |
|    127 | Sedative-Feline              |          25.00 |
|    128 | Flea Treatment- Small Animal |          35.00 |
|    129 | Flea Treatment- Large Animal |          50.00 |
|    130 | Routine Exam- Canine         |          55.00 |
|    131 | Followup Exam- Canine        |          35.00 |
|    132 | Dental Cleaning-Canine       |          50.00 |
|    133 | Dental Cleaning-Feline       |          45.00 |
|    143 | Rabies_V-2010 SFall-Canine   |          15.00 |
|    144 | Rabies_V-2010 SFall-Feline   |          15.00 |
|    145 | Rabies_V-2010 Spring-Canine  |          25.00 |
|    146 | Rabies_V-2010 Spring-Feline  |          25.00 |
|    147 | Rabies_V-2010 Winter-Canine  |          15.00 |
+--------+------------------------------+----------------+
37 rows in set (0.00 sec)

--------------
/*  TASK 07 */
replace into upd_services
Select A.item_id as srv_id
, A.item_desc as srv_desc
, A.item_list_price as srv_list_price
From upd_services_changes_2 A
Where A.item_id not in (
	Select B.srv_id
	From upd_services B)
--------------

Query OK, 4 rows affected (0.00 sec)
Records: 4  Duplicates: 0  Warnings: 0

--------------
	
Select *
From upd_services
Order by srv_id
--------------

+--------+------------------------------+----------------+
| srv_id | srv_desc                     | srv_list_price |
+--------+------------------------------+----------------+
|    100 | Consult- no charge           |           0.00 |
|    101 | Routine Exam- Bird           |          35.00 |
|    102 | Followup Exam-Bird           |          32.00 |
|    103 | Routine Exam-Feline          |          50.00 |
|    104 | Followup Exam-Feline         |          45.00 |
|    105 | Routine Exam-Reptile         |          25.00 |
|    106 | Followup Exam-Reptile        |          23.00 |
|    107 | Rabies_V-2008 SFall-Canine   |          15.00 |
|    108 | Rabies_V-2008 SFall-Feline   |          15.00 |
|    109 | Rabies_Ve-2008 Spring-Canine |          25.00 |
|    110 | Rabies_V-2008 Spring-Feline  |          25.00 |
|    111 | Rabies_V-Rodent              |          20.00 |
|    112 | Rabies_V-2008 Winter-Canine  |          15.00 |
|    113 | Amphib skin Ointment         |          75.00 |
|    114 | H1N1 vaccine                 |          75.00 |
|    115 | H1N2 vaccine                 |          75.00 |
|    116 | Reptile dental procedure     |         175.00 |
|    117 | Amphib dental procedure      |         375.00 |
|    118 | First Feline PCR             |          20.25 |
|    119 | Second Feline PCR            |          20.25 |
|    120 | Third Feline PCR             |          20.25 |
|    121 | Flu Rhino Vacc               |          26.00 |
|    122 | Scaly Mite                   |          35.00 |
|    123 | Intestinal Parasite Screen   |          26.00 |
|    124 | Tick Removal                 |          15.00 |
|    125 | Behaviour Modification       |          75.00 |
|    126 | Vitamin E- Concentrated      |          30.00 |
|    127 | Sedative-Feline              |          25.00 |
|    128 | Flea Treatment- Small Animal |          35.00 |
|    129 | Flea Treatment- Large Animal |          50.00 |
|    130 | Routine Exam- Canine         |          55.00 |
|    131 | Followup Exam- Canine        |          35.00 |
|    132 | Dental Cleaning-Canine       |          50.00 |
|    133 | Dental Cleaning-Feline       |          45.00 |
|    134 | Vitamin E series             |          55.00 |
|    135 | Feline PCR Series            |          75.00 |
|    143 | Rabies_V-2010 SFall-Canine   |          15.00 |
|    144 | Rabies_V-2010 SFall-Feline   |          15.00 |
|    145 | Rabies_V-2010 Spring-Canine  |          25.00 |
|    146 | Rabies_V-2010 Spring-Feline  |          25.00 |
|    147 | Rabies_V-2010 Winter-Canine  |          15.00 |
+--------+------------------------------+----------------+
41 rows in set (0.00 sec)

--------------
/*  TASK 08 */
replace into upd_services
Select A.item_id as srv_id
, coalesce((case A.item_desc when '' then null else A.item_desc end), B.srv_desc) as srv_desc
, coalesce(A.item_list_price, B.srv_list_price) as srv_list_price
From upd_services_changes_3 A
join upd_services B on A.item_id = B.srv_id
Where A.item_id in (
	Select B.srv_id
	From upd_services B)
--------------

Query OK, 16 rows affected (0.00 sec)
Records: 8  Duplicates: 8  Warnings: 0

--------------
Select *
From upd_services
Order by srv_id
--------------

+--------+------------------------------+----------------+
| srv_id | srv_desc                     | srv_list_price |
+--------+------------------------------+----------------+
|    100 | Consult- no charge           |           0.00 |
|    101 | Routine Exam- Bird           |          35.00 |
|    102 | Followup Exam-Bird           |          32.00 |
|    103 | Routine Exam-Feline          |          50.00 |
|    104 | Followup Exam-Feline         |          45.00 |
|    105 | Routine Exam-Reptile         |          35.00 |
|    106 | Followup Exam-Reptile        |          30.00 |
|    107 | Rabies_V-2008 SFall-Canine   |          15.00 |
|    108 | Rabies_V-2008 SFall-Feline   |          15.00 |
|    109 | Rabies_Ve-2008 Spring-Canine |          25.00 |
|    110 | Rabies_V-2008 Spring-Feline  |          25.00 |
|    111 | Rabies_V-Rodent              |          35.25 |
|    112 | Rabies_V-2008 Winter-Canine  |          15.00 |
|    113 | Amphib skin Ointment         |          75.00 |
|    114 | H1N1 vaccine                 |          75.00 |
|    115 | H1N2 vaccine                 |          75.00 |
|    116 | Reptile dental procedure     |         175.00 |
|    117 | Amphib dental procedure      |         375.00 |
|    118 | First Feline PCR             |          20.25 |
|    119 | Second Feline PCR            |          20.25 |
|    120 | Third Feline PCR             |          20.25 |
|    121 | Flu Rhino Vacc               |          26.00 |
|    122 | Scaly Mite Powder            |          35.00 |
|    123 | Intestinal Parasite Screen   |          26.00 |
|    124 | Tick Removal                 |          25.95 |
|    125 | Behaviour Modification       |          75.00 |
|    126 | Vitamin E- Concentrated      |          45.00 |
|    127 | Sedative-Feline              |          25.00 |
|    128 | Flea Treatment- Small Animal |          45.00 |
|    129 | Flea Treatment- Large Animal |          65.00 |
|    130 | Routine Exam- Canine         |          55.00 |
|    131 | Followup Exam- Canine        |          35.00 |
|    132 | Dental Cleaning-Canine       |          50.00 |
|    133 | Dental Cleaning-Feline       |          45.00 |
|    134 | Vitamin E series             |          55.00 |
|    135 | Feline PCR Series            |          75.00 |
|    143 | Rabies_V-2010 SFall-Canine   |          15.00 |
|    144 | Rabies_V-2010 SFall-Feline   |          15.00 |
|    145 | Rabies_V-2010 Spring-Canine  |          25.00 |
|    146 | Rabies_V-2010 Spring-Feline  |          25.00 |
|    147 | Rabies_V-2010 Winter-Canine  |          15.00 |
+--------+------------------------------+----------------+
41 rows in set (0.00 sec)

--------------
/*  TASK 09 */
replace into upd_services
Select item_id as srv_id
, item_desc as srv_desc
, item_list_price as srv_list_price
From upd_services_changes_4
Where item_list_price Between 1 and 100
--------------

Query OK, 6 rows affected (0.03 sec)
Records: 4  Duplicates: 2  Warnings: 0

--------------
Select *
From upd_services
Order by srv_id
--------------

+--------+------------------------------+----------------+
| srv_id | srv_desc                     | srv_list_price |
+--------+------------------------------+----------------+
|    100 | Consult- no charge           |           0.00 |
|    101 | Routine Exam- Bird           |          35.00 |
|    102 | Followup Exam-Bird           |          32.00 |
|    103 | Routine Exam-Feline          |          50.00 |
|    104 | Followup Exam-Feline         |          45.00 |
|    105 | Routine Exam-Reptile         |          35.00 |
|    106 | Followup Exam-Reptile        |          30.00 |
|    107 | Rabies_V-2008 SFall-Canine   |          15.00 |
|    108 | Rabies_V-2008 SFall-Feline   |          15.00 |
|    109 | Rabies_Ve-2008 Spring-Canine |          25.00 |
|    110 | Rabies_V-2008 Spring-Feline  |          25.00 |
|    111 | Rabies_V-Rodent              |          35.25 |
|    112 | Rabies_V-2008 Winter-Canine  |          15.00 |
|    113 | Amphib skin Ointment         |          75.00 |
|    114 | H1N1 vaccine                 |          75.00 |
|    115 | H1N2 vaccine                 |          75.00 |
|    116 | Reptile dental procedure     |         175.00 |
|    117 | Amphib dental procedure      |         375.00 |
|    118 | First Feline PCR             |          20.25 |
|    119 | Second Feline PCR            |          20.25 |
|    120 | Third Feline PCR             |          20.25 |
|    121 | Flu Rhino Vacc               |          26.00 |
|    122 | Scaly Mite Powder            |          35.00 |
|    123 | Intestinal Parasite Screen   |          26.00 |
|    124 | Tick Removal                 |          25.95 |
|    125 | Behaviour Modification       |          75.00 |
|    126 | Vitamin E- Concentrated      |          45.00 |
|    127 | Sedative-Feline              |          95.50 |
|    128 | Flea Treatment- Small Animal |          37.50 |
|    129 | Flea Treatment- Large Animal |          65.00 |
|    130 | Routine Exam- Canine         |          55.00 |
|    131 | Followup Exam- Canine        |          35.00 |
|    132 | Dental Cleaning-Canine       |          50.00 |
|    133 | Dental Cleaning-Feline       |          45.00 |
|    134 | Vitamin E series             |          55.00 |
|    135 | Feline PCR Series            |          75.00 |
|    138 | Antibiotic 100mg             |          45.00 |
|    140 | Fish Hook Removal            |          20.00 |
|    143 | Rabies_V-2010 SFall-Canine   |          15.00 |
|    144 | Rabies_V-2010 SFall-Feline   |          15.00 |
|    145 | Rabies_V-2010 Spring-Canine  |          25.00 |
|    146 | Rabies_V-2010 Spring-Feline  |          25.00 |
|    147 | Rabies_V-2010 Winter-Canine  |          15.00 |
+--------+------------------------------+----------------+
43 rows in set (0.00 sec)

Bye
